'use strict';django.jQuery(function($){var firstRun=true,backendFieldSelector='#id_config-0-backend',orgFieldSelector='#id_organization',isDeviceGroup=function(){return window._deviceGroup;},templatesFieldName=function(){return isDeviceGroup()?'templates':'config-0-templates';},getTemplateOptionElement=function(index,templateId,templateConfig,isSelected=false,isPrefix=false){if(templateConfig===undefined){return;}
var prefix=isPrefix?'__prefix__-':'',requiredString=templateConfig.required?' (required)':'',backendString=isDeviceGroup()&&templateConfig.backend?` (backend: ${templateConfig.backend})`:'',element=$(`<li class="sortedm2m-item"><label for="id_config-${prefix}templates_${index}"><input type="checkbox" value="${templateId}" id="id_config-${prefix}templates_${index}" class="sortedm2m" data-required=${templateConfig.required}> ${templateConfig.name}${requiredString}${backendString}</label></li>`),inputField=element.children().children('input');if(templateConfig.required){inputField.prop('disabled',true);}
if(isSelected||templateConfig.required){inputField.prop('checked',true);}
return element;},resetTemplateOptions=function(){$('ul.sortedm2m-items').empty();},updateTemplateSelection=function(selectedTemplates){selectedTemplates.forEach(function(templateId){$(`li.sortedm2m-item input[type="checkbox"][value="${templateId}"]:first`).prop('checked',true);});},updateTemplateHelpText=function(){var helpText='Choose items and order by drag & drop.';if($('li.sortedm2m-item:first').length===0){helpText='No Template available';}
if(gettext){helpText=gettext(helpText);}
$('.sortedm2m-container > .help').text(helpText);},addChangeEventHandlerToBackendField=function(){$(backendFieldSelector).change(function(){setTimeout(function(){showRelevantTemplates();});});showRelevantTemplates();},updateConfigTemplateField=function(templates){$(`input[name="${templatesFieldName()}"]`).attr('value',templates.join(','));$('input.sortedm2m:first').trigger('change');},parseSelectedTemplates=function(selectedTemplates){if(selectedTemplates!==undefined){if(selectedTemplates===''){return[];}else{return selectedTemplates.split(',');}}},showRelevantTemplates=function(){var orgID=$(orgFieldSelector).val(),backend=isDeviceGroup()?"":$(backendFieldSelector).val(),selectedTemplates;if(orgID.length===0||!isDeviceGroup()&&backend.length===0){resetTemplateOptions();updateTemplateHelpText();return;}
if(firstRun){selectedTemplates=isDeviceGroup()?parseSelectedTemplates($("#id_templates").val()):parseSelectedTemplates(django._owcInitialValues[templatesFieldName()]);}
var url=window._relevantTemplateUrl.replace('org_id',orgID);url=url+'?backend='+backend;$.get(url).done(function(data){resetTemplateOptions();var enabledTemplates=[],sortedm2mUl=$('ul.sortedm2m-items:first'),sortedm2mPrefixUl=$('ul.sortedm2m-items:last');if(selectedTemplates!==undefined){selectedTemplates.forEach(function(templateId,index){if(!data[templateId]){return;}
var element=getTemplateOptionElement(index,templateId,data[templateId],true,false),prefixElement=getTemplateOptionElement(index,templateId,data[templateId],true,true);sortedm2mUl.append(element);if(!isDeviceGroup()){sortedm2mPrefixUl.append(prefixElement);}
delete data[templateId];});}
var counter=selectedTemplates!==undefined?selectedTemplates.length:0;Object.keys(data).forEach(function(templateId,index){if(!data[templateId]){return;}
index=index+counter;var isSelected=(data[templateId].default&&(selectedTemplates===undefined))&&(!data[templateId].required),element=getTemplateOptionElement(index,templateId,data[templateId],isSelected),prefixElement=getTemplateOptionElement(index,templateId,data[templateId],isSelected,true);if(isSelected===true){enabledTemplates.push(templateId);}
sortedm2mUl.append(element);if(!isDeviceGroup()){sortedm2mPrefixUl.append(prefixElement);}});if(firstRun===true&&selectedTemplates!==undefined){updateTemplateSelection(selectedTemplates);}
updateTemplateHelpText();updateConfigTemplateField(enabledTemplates);});},bindDefaultTemplateLoading=function(){var backendField=$(backendFieldSelector);$(orgFieldSelector).change(function(){if($(backendFieldSelector).length>0||isDeviceGroup()){showRelevantTemplates();}});if(backendField.length>0){addChangeEventHandlerToBackendField();}else if(isDeviceGroup()){showRelevantTemplates();}
else{$('#config-group > fieldset.module').ready(function(){$('div.add-row > a').one('click',function(){addChangeEventHandlerToBackendField();});});}
firstRun=false;$('#content-main form').submit(function(){$('ul.sortedm2m-items:first input[type="checkbox"][data-required="true"]').prop('checked',false);});};window.bindDefaultTemplateLoading=bindDefaultTemplateLoading;});